@model IEnumerable<ComputerStore.Models.ProductDetail>

@{
    ViewBag.Title = "Index Product Details";
    Layout = "~/Areas/User/Views/Shared/_LayoutUser.cshtml";
}

<head>
    <!--#region NiceAdmin Template-->
    <!-- Vendor CSS Files -->
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/simple-datatables/style.css" rel="stylesheet">


    <!-- Template Main CSS File -->
    <link href="~/assets_user/NiceAdmin/NiceAdmin/assets/css/style.css" rel="stylesheet">
    <!--#endregion-->

    <link rel="stylesheet" href="~/assets_user/css/NHD-css.css" /><!--NgHuuDuy css file modify-->

</head>

<div class="my-container dashboard">
    <div class="pagetitle">
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "TestView")">Home</a></li>
                <li class="breadcrumb-item active">Catalog Name</li>
                <li class="breadcrumb-item active">Product Details Page</li>
            </ol>
        </nav>
    </div><!-- End Page Title -->

    <div class="container">
        <div class="row product-general-info">
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">With controls</h5>

                        <!-- Slides with controls -->
                        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                            @if (Model.FirstOrDefault() != null)
                            {
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img src="~/assets_user/image/data-image/@Model.First().Product.Image1" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="~/assets_user/image/data-image/@Model.First().Product.Image1" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="~/assets_user/image/data-image/@Model.First().Product.Image1" class="d-block w-100" alt="...">
                                    </div>
                                </div>
                            }
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>

                        </div><!-- End Slides with controls -->

                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <!-- Default Card -->
                <div class="card">
                    <div class="card-body">
                        <div class="m-product-info">
                            @if (Model.FirstOrDefault() != null)
                            {
                                <div class="m-info-top">
                                    <h5 class="m-product-name">@Model.First().Product.ProductName<i class="far fa-heart fa-pull-right"></i></h5><!--Wishlist Click-->
                                    <div class="m-product-rating">
                                        <span class="m-rating-star">
                                            0.0 <i class="fas fa-star"></i>
                                        </span>
                                        <span><a href="#">Xem đánh giá</a></span>
                                    </div>
                                </div>
                                <div class="m-info-bottom">
                                    <div class="m-product-price">
                                        <div class="m-origin-price">
                                            @Model.First().Product.Price.ToString("N0")₫
                                        </div>
                                        <div class="m-discount-price">@Model.First().Product.Price</div>
                                        <div class="m-discount-percent">1%</div>
                                    </div>
                                    <div class="product-gift">
                                        <div class="box-header text-danger">
                                            <i class="fas fa-gift"></i>
                                            <span>Quà tặng khuyến mãi</span>
                                        </div>
                                        <div class="gift-info text-danger">
                                            <ul style="padding-left: 0 !important;">
                                                <li>
                                                    <span class="rouded-number">1</span>
                                                    <span class="list-gift"><a href="#">Tặng ngay 1 x Tản nhiệt AIO Corsair iCUE LINK TITAN 240 RX RGB WHITE (CW-9061020-WW) trị giá 3.990.000₫</a></span>
                                                </li>
                                                <!--Add more gift here-->
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="m-cart-item" data-product-id="" data-max-quantity="">
                                        <div class="d-flex flex-row gap-3 m-2 p-2">
                                            <div>Số lượng</div>
                                            <div>
                                                <button class="decrease">-</button>
                                                <!--Validate product quantity here-->
                                                <input type="number" id="quantity" class="text-danger text-center pl-1 quantity" size="10" value="1" min="1" />
                                                <button class="increase">+</button>
                                            </div>
                                            <div>@Model.First().Product.Quantity sản phẩm có sẵn</div>
                                        </div>
                                        <div class="m-error" style="display:none;">
                                            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                                <i class="bi bi-exclamation-triangle me-1"></i>
                                                Vượt quá số lượng cho phép!
                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row gap-3">
                                        <button id="addToCartBtn" type="button" class="btn btn-outline-danger">
                                            <i class="fas fa-shopping-cart"></i>
                                            Thêm vào giỏ hàng
                                        </button>
                                        <button id="buyNowBtn" type="button" class="btn btn-danger btn-buynow">
                                            <span class="maintext">MUA NGAY</span>
                                            <span class="subtext">Giao tận nơi hoặc nhận tại cửa hảng</span>
                                        </button>
                                    </div>
                                </div>
                            }

                        </div>
                    </div>
                </div><!-- End Default Card -->
            </div>
        </div>

        <div class="row product-details">
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-body">
                        <div class="font-weight-bold h4 p-2 pt-3">Thông số kỹ thuật</div>
                        <table class="table">
                            <tbody>
                                @if (Model != null && Model.Any())
                                {
                                    foreach (var specDetail in Model)
                                    {
                                        <tr>
                                            <!--Use foreach to generate table data-->
                                            <th scope="row">@specDetail.ProductSpecification.SpecificationName</th>
                                            <td scope="row">@specDetail.SpecificationValue</td>
                                        </tr>

                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card product-feedback-rating">
                    <div class="h4 p-4 pb-0 font-weight-bold">Product Feedback & Rating Product Name Here</div>
                    <div class="card-body">

                        <div class="card-body">
                            <h5 class="card-title m-rating-star">
                                4.2
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <a href="#" class="m-font-size-14">80 đánh giá</a>
                            </h5>

                            <div class="d-flex flex-row align-items-center m-font-size-12">
                                <div>
                                    <p>5 <i class="fas fa-star"></i></p>
                                    <p>4 <i class="fas fa-star"></i></p>
                                    <p>3 <i class="fas fa-star"></i></p>
                                    <p>2 <i class="fas fa-star"></i></p>
                                    <p>1 <i class="fas fa-star"></i></p>
                                </div>
                                <div class="card-body  pt-2">
                                    <!-- Default Progress Bars-->
                                    <div class="progress">
                                        <div class="progress-bar text-bg-warning" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="progress mt-3">
                                        <div class="progress-bar text-bg-warning" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="progress mt-3">
                                        <div class="progress-bar text-bg-warning" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="progress mt-3">
                                        <div class="progress-bar text-bg-warning" role="progressbar" style="width: 65%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="progress mt-3">
                                        <div class="progress-bar text-bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <!-- End Default Progress Bars-->
                                </div>
                                <div>
                                    <p>25%</p>
                                    <p>25%</p>
                                    <p>25%</p>
                                    <p>25%</p>
                                    <p>25%</p>
                                </div>

                            </div>

                        </div>

                        <div class="d-flex flex-row gap-4 justify-content-center align-items-center">
                            <img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" />
                            <img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" />
                            <img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" />
                            <img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" />
                            <a href="#" class="text-center">Xem thêm ảnh từ khách hàng</a>
                        </div>
                        <ul class="list-group list-group-flush pt-3">
                            <!--Load some comment here, use foreach to load every li elements-->
                            <li class="d-flex flex-column list-group-item">
                                <div class="font-weight-bold">Đoàn Ngọc Ánh Linh</div>
                                <div class="m-rating-star">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <div class="m-font-size-14">
                                    Chuột dùng được vài tháng đã bắt đầu liệt nút bấm mạnh mới được. Mình muốn bảo hành thì như nào ạ
                                </div>
                            </li>
                            <li class="d-flex flex-column list-group-item">
                                <div class="font-weight-bold">Đoàn Ngọc Ánh Linh</div>
                                <div class="m-rating-star">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <div class="m-font-size-14">
                                    Chuột dùng được vài tháng đã bắt đầu liệt nút bấm mạnh mới được. Mình muốn bảo hành thì như nào ạ đsấđsakjákkadskjsdkj
                                    Chuột dùng được vài tháng đã bắt đầu liệt nút bấm mạnh mới được. Mình muốn bảo hành thì như nào ạ
                                </div>
                            </li>
                            <li class="d-flex flex-column list-group-item">
                                <div class="font-weight-bold">Đoàn Ngọc Ánh Linh</div>
                                <div class="m-rating-star">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <div class="m-font-size-14">
                                    Chuột dùng được vài tháng đã bắt đầu liệt nút bấm mạnh mới được. Mình muốn bảo hành thì như nào ạ
                                </div>
                            </li>
                        </ul>

                        <div class="card-body pt-3">
                            <!-- Basic Modal -->
                            <div class=" d-flex flex-row justify-content-center gap-2">
                                <button type="button" class="btn btn-outline-primary" style="width: 50%;">Xem thêm 10 đánh giá</button>
                                <button type="button" class="btn btn-primary" style="width: 50%;" data-bs-toggle="modal" data-bs-target="#basicModal">
                                    Viết đánh giá
                                </button>
                            </div>

                            <div class="modal fade" id="basicModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">ĐÁNH GIÁ SẢN PHẨM</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form class="pt-2" id="ratingForm" method="post" action="@Url.Action("Index", "Home")">
                                                <!--Link to button with id-->
                                                <div class="row mb-3">
                                                    <label class="col-sm-2">Đánh giá</label>
                                                    <div class="col-sm-10">
                                                        <div class="form-floating mb-3">
                                                            <select class="form-select m-rating-star" id="floatingSelect" aria-label="Floating label select example">
                                                                <option selected>5 sao</option>
                                                                <option>4 sao</option>
                                                                <option>3 sao</option>
                                                                <option>2 sao</option>
                                                                <option>1 sao</option>
                                                            </select>
                                                            <label for="floatingSelect">Đánh giá</label>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea" style="height: 100px;"></textarea>
                                                            <label for="floatingTextarea">Bình luận</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <label for="inputNumber" class="col-sm-2">Tải ảnh lên</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="file" id="formFile">
                                                    </div>
                                                </div>
                                                <div class="fa-pull-right">(tối đa 1 ảnh)</div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary fa-pull-right" form="ratingForm">Gửi đánh giá</button>
                                        </div>
                                    </div>
                                </div>
                            </div><!-- End Basic Modal-->

                        </div>

                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="card p-2">
                    <h4 class="p-1">
                        Sản phẩm tương tự
                    </h4>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <td><img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" /></td>
                                <td class="related-product">
                                    <h6>PC GVN x Corsair iCUE (Intel i5-14600KF/ VGA RTX 4060 Ti)</h6>
                                    <div class="m-discount-price">33.320.000₫</div>
                                    <div class="m-product-price">
                                        <div class="m-origin-price">
                                            32.990.000₫
                                        </div>
                                        <div class="m-discount-percent">1%</div>
                                    </div>
                                    <div class="m-product-rating">
                                        <span class="m-rating-star">
                                            0.0 <i class="fas fa-star"></i>
                                        </span>
                                        <span><a href="#">(0) đánh giá</a></span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" /></td>
                                <td class="related-product">
                                    <h6>PC GVN x Corsair iCUE (Intel i5-14600KF/ VGA RTX 4060 Ti)</h6>
                                    <div class="m-discount-price">33.320.000₫</div>
                                    <div class="m-product-price">
                                        <div class="m-origin-price">
                                            32.990.000₫
                                        </div>
                                        <div class="m-discount-percent">1%</div>
                                    </div>
                                    <div class="m-product-rating">
                                        <span class="m-rating-star">
                                            0.0 <i class="fas fa-star"></i>
                                        </span>
                                        <span><a href="#">(0) đánh giá</a></span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><img class="sm-rouded-img" src="~/assets_user/image/NHD-Images/pc-2.png" alt="Product Image" /></td>
                                <td class="related-product">
                                    <h6>PC GVN x Corsair iCUE (Intel i5-14600KF/ VGA RTX 4060 Ti)</h6>
                                    <div class="m-discount-price">33.320.000₫</div>
                                    <div class="m-product-price">
                                        <div class="m-origin-price">
                                            32.990.000₫
                                        </div>
                                        <div class="m-discount-percent">1%</div>
                                    </div>
                                    <div class="m-product-rating">
                                        <span class="m-rating-star">
                                            0.0 <i class="fas fa-star"></i>
                                        </span>
                                        <span><a href="#">(0) đánh giá</a></span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="filter">
                        <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <li class="dropdown-header text-start">
                                <h6>Filter</h6>
                            </li>

                            <li><a class="dropdown-item" href="#">Today</a></li>
                            <li><a class="dropdown-item" href="#">This Month</a></li>
                            <li><a class="dropdown-item" href="#">This Year</a></li>
                        </ul>
                    </div>

                    <div class="card-body pb-0">
                        <h5 class="card-title">News &amp; Updates <span>| Today</span></h5>
                        <div class="news">
                            <div class="post-item clearfix">
                                <img src="~/assets_user/NiceAdmin/NiceAdmin/assets/img/news-1.jpg" alt="">
                                <h4><a href="#">Nihil blanditiis at in nihil autem</a></h4>
                                <p>Sit recusandae non aspernatur laboriosam. Quia enim eligendi sed ut harum...</p>
                            </div>

                            <div class="post-item clearfix">
                                <img src="~/assets_user/NiceAdmin/NiceAdmin/assets/img/news-2.jpg" alt="">
                                <h4><a href="#">Quidem autem et impedit</a></h4>
                                <p>Illo nemo neque maiores vitae officiis cum eum turos elan dries werona nande...</p>
                            </div>

                            <div class="post-item clearfix">
                                <img src="~/assets_user/NiceAdmin/NiceAdmin/assets/img/news-3.jpg" alt="">
                                <h4><a href="#">Id quia et et ut maxime similique occaecati ut</a></h4>
                                <p>Fugiat voluptas vero eaque accusantium eos. Consequuntur sed ipsam et totam...</p>
                            </div>

                            <div class="post-item clearfix">
                                <img src="~/assets_user/NiceAdmin/NiceAdmin/assets/img/news-4.jpg" alt="">
                                <h4><a href="#">Laborum corporis quo dara net para</a></h4>
                                <p>Qui enim quia optio. Eligendi aut asperiores enim repellendusvel rerum cuder...</p>
                            </div>

                            <div class="post-item clearfix">
                                <img src="~/assets_user/NiceAdmin/NiceAdmin/assets/img/news-5.jpg" alt="">
                                <h4><a href="#">Et dolores corrupti quae illo quod dolor</a></h4>
                                <p>Odit ut eveniet modi reiciendis. Atque cupiditate libero beatae dignissimos eius...</p>
                            </div>

                        </div><!-- End sidebar recent posts-->

                    </div>
                </div><!-- End News & Updates -->
            </div>
        </div>

    </div>
</div>
<script>
    //Xử lý Event thêm giỏ hàng và mua
        document.getElementById('addToCartBtn').addEventListener('click', function () {
        var productId = @Model.First().ProductID;
        var quantity = document.getElementById('quantity').value;

            fetch('/CartItems/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId: productId, quantity: quantity })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                } else {
                    alert(data.message);
                }
            })
            .catch(error => console.error('Error:', error));
    });

    document.getElementById('buyNowBtn').addEventListener('click', function () {
        var productId = @Model.First().ProductID;
        var quantity = document.getElementById('quantity').value;

        fetch('/CartItems/BuyNow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId: productId, quantity: quantity })
        })
            .then(() => {
                window.location.href = '../../CartItems/Index';
            })
            .catch(error => console.error('Error:', error));
    });

    // Lấy giá trị max quantity từ Razor
    const maxQuantity = @Model.First().Product.Quantity;

    const cartItems = document.querySelectorAll(".m-cart-item");

    cartItems.forEach((item) => {
        const quantityInput = item.querySelector(".quantity");
        const increaseBtn = item.querySelector(".increase");
        const decreaseBtn = item.querySelector(".decrease");
        const errorMsg = item.querySelector(".m-error");

        function validateQuantity() {
            quantityInput.value = quantityInput.value.replace(/\D/g, "");
            let currentValue = parseInt(quantityInput.value);

            if (isNaN(currentValue) || currentValue < 1) {
                quantityInput.value = 1;
                errorMsg.style.display = "none";
            } else if (currentValue > maxQuantity) {
                quantityInput.value = maxQuantity;
                errorMsg.style.display = "block";
            } else {
                errorMsg.style.display = "none";
            }
        }

        increaseBtn.addEventListener("click", () => {
            let currentValue = parseInt(quantityInput.value) || 1;

            if (currentValue < maxQuantity) {
                quantityInput.value = currentValue + 1;
            }

            validateQuantity();
        });

        decreaseBtn.addEventListener("click", () => {
            let currentValue = parseInt(quantityInput.value) || 1;

            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }

            validateQuantity();
        });

        quantityInput.addEventListener("input", validateQuantity);
        quantityInput.addEventListener("blur", validateQuantity);
    });
</script>
<!--#region Script-->
<!-- Vendor JS Files -->
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/apexcharts/apexcharts.min.js"></script>
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
@*<script src="assets/vendor/chart.js/chart.umd.js"></script>*@
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/echarts/echarts.min.js"></script>
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/quill/quill.js"></script>
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/simple-datatables/simple-datatables.js"></script>
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/tinymce/tinymce.min.js"></script>
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="~/assets_user/NiceAdmin/NiceAdmin/assets/js/main.js"></script>
<!--#endregion Script-->
<!--Quantity check-->
